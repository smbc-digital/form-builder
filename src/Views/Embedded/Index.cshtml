<script>
    const form = document.querySelector("form");
    let formChanged = false;

    function handleChange(event) {
        if (!formChanged) {
            formChanged = true;
            console.log("Form has been modified.");
        }
        sendHeight();
    }

    function sendHeight() {
        const element = document.querySelector('.smbc-embeddable');
        if (!element) return;

        const height = element.offsetHeight;
        const parentOrigin = document.referrer.split('/').slice(0, 3).join('/') + '/';
        console.log("height ", height)
        const allowedOrigins = [
            "https://int-webplatform-stockroom.smbcdigital.net/",
            "https://qa-webplatform-stockroom.smbcdigital.net/",
            "https://stage-webplatform-stockroom.smbcdigital.net/",
            "https://www.stockrm.org/"
        ];

        if (allowedOrigins.includes(parentOrigin)) {
            window.parent.postMessage({ iframeHeight: height }, parentOrigin);
        }
    }

    window.onload = sendHeight;
    window.onresize = sendHeight;
    document.getElementsByClassName("govuk-button")[0].onclick = sendHeight;
    form.addEventListener("input", handleChange);
    form.addEventListener("change", handleChange);

    const smbcEmbeddable = document.querySelector('.smbc-embeddable');
    if (smbcEmbeddable)
        new ResizeObserver(sendHeight).observe(smbcEmbeddable);
</script>

<style>
    .freeprivacypolicy-com---nb, .govuk-skip-link {
        display: none;
    }

    .smbc-container-embeddable {
        margin-inline: 0;
    }
</style>